<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mantra Repetition Counter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg: #fdfaf6;
      --text: #333;
      --primary: #ff9800;
      --accent: #fff3e0;
    }
    body.dark {
      --bg: #1e1e1e;
      --text: #eee;
      --primary: #90caf9;
      --accent: #2c2c2c;
    }
    body.sattvic {
      --bg: #fff7e6;
      --text: #5c3c00;
      --primary: #fbc02d;
      --accent: #fffde7;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      text-align: center;
      transition: background 0.3s, color 0.3s;
    }
    h1 {
      color: var(--primary);
    }
    input, button, select {
      font-size: 18px;
      padding: 10px;
      margin: 10px;
      border-radius: 10px;
      border: none;
      outline: none;
      transition: box-shadow 0.3s;
    }
    input {
      width: 80%;
      max-width: 400px;
      background: var(--accent);
    }
    button {
      background: var(--primary);
      color: white;
      cursor: pointer;
      font-size: 30px;
      padding: 30px 50px;
      min-width: 250px;
      margin: 20px;
    }
    button:hover {
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    .counter {
      font-size: 48px;
      margin: 20px 0;
    }
    .controls {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
    }
    .filter-section {
      margin: 20px 0;
    }
    .theme-toggle {
      margin-top: 20px;
    }
    .mantra-entry {
      margin-top: 20px;
    }
    img.god-img {
      max-height: 100px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Mantra Counter</h1>

  <div class="mantra-entry">
    <input type="text" id="mantraInput" placeholder="Enter Mantra">
    <input type="file" id="godImageInput" accept="image/*">
    <div><img id="godImage" class="god-img" alt="" /></div>
    <button onclick="setMantra()">Set Mantra</button>
  </div>

  <div id="currentMantra" style="font-size: 24px; margin: 10px 0;"></div>
  <div class="counter" id="countDisplay">0</div>

  <div class="controls">
    <button id="repeatBtn" onclick="repeatMantra()">Repeat</button>
    <button onclick="resetCount()">Reset</button>
    <button onclick="viewHistory()">History</button>
    <button onclick="syncToCloud()">Sync</button>
  </div>

  <div class="filter-section">
    <input type="text" id="searchInput" placeholder="Search mantras...">
    <br>
    <label>From: <input type="date" id="fromDate"></label>
    <label>To: <input type="date" id="toDate"></label>
  </div>

  <div class="theme-toggle">
    <label>Theme:
      <select id="themeSelect" onchange="setTheme(this.value)">
        <option value="default">Light</option>
        <option value="dark">Dark</option>
        <option value="sattvic">Sattvic</option>
      </select>
    </label>
  </div>

  <script>
    let count = 0;
    let currentMantra = "";
    let currentMantraImg = "";

    function setMantra() {
      const input = document.getElementById("mantraInput").value.trim();
      if (input) {
        currentMantra = input;
        count = 0;
        document.getElementById("countDisplay").textContent = count;
        document.getElementById("currentMantra").textContent = `Current: "${input}"`;
        storeMantra(input);
      }
    }

    function repeatMantra() {
      if (!currentMantra) return;
      count++;
      document.getElementById("countDisplay").textContent = count;
      storeCount(currentMantra, count);
      storeDailyCount(currentMantra);
      if (navigator.vibrate) navigator.vibrate(50);
    }

    function resetCount() {
      count = 0;
      document.getElementById("countDisplay").textContent = count;
    }

    function storeMantra(text) {
      let history = JSON.parse(localStorage.getItem("mantraHistory") || "[]");
      if (!history.find(m => m.text === text)) {
        history.push({ text, count: 0 });
        localStorage.setItem("mantraHistory", JSON.stringify(history));
      }
    }

    function storeCount(text, count) {
      let history = JSON.parse(localStorage.getItem("mantraHistory") || "[]");
      let mantra = history.find(m => m.text === text);
      if (mantra) {
        mantra.count = count;
        localStorage.setItem("mantraHistory", JSON.stringify(history));
      }
    }

    function storeDailyCount(text) {
      const today = new Date().toISOString().split("T")[0];
      const key = "mantraDailyCounts_" + text;
      let data = JSON.parse(localStorage.getItem(key) || "{}");
      data[today] = (data[today] || 0) + 1;
      localStorage.setItem(key, JSON.stringify(data));
    }

    function viewHistory() {
      window.location.href = "history.html";
    }

    function setTheme(theme) {
      document.body.classList.remove("dark", "sattvic");
      if (theme !== "default") document.body.classList.add(theme);
      localStorage.setItem("theme", theme);
    }

    function loadTheme() {
      const saved = localStorage.getItem("theme");
      if (saved) {
        document.getElementById("themeSelect").value = saved;
        setTheme(saved);
      }
    }

    function syncToCloud() {
      alert("Cloud sync feature coming soon!");
    }

    document.getElementById("godImageInput").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = () => {
          document.getElementById("godImage").src = reader.result;
          currentMantraImg = reader.result;
        };
        reader.readAsDataURL(file);
      }
    });

    loadTheme();
  </script>
</body>
</html>